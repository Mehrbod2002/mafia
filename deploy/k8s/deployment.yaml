apiVersion: apps/v1
kind: Deployment
metadata: name: mafia-api
spec:
  replicas: 10
  template:
    spec:
      containers:
      - name: api
        image: mafia/api:v1.0.0
        ports: [{containerPort: 8080}, {containerPort: 1935}]
        resources:
          requests: {cpu: "500m", memory: "512Mi"}
          limits: {cpu: "2", memory: "2Gi"}
        livenessProbe: {httpGet: {path: /health, port: 8080}, initialDelaySeconds: 30}
        readinessProbe: {httpGet: {path: /ready, port: 8080}, initialDelaySeconds: 5}
---
apiVersion: v1
kind: Service
metadata: name: mafia-api
spec:
  selector: {app: mafia-api}
  ports: [{port: 80, targetPort: 8080}, {port: 1935, targetPort: 1935}]
  type: LoadBalancer
